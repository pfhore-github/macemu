# 68040仕様
## レジスタ

- データレジスタ(DR0-DR7)[32bit]
- アドレスレジスタ(AR0-AR7)[32bit]
- ユーザスタックポインタ(USP)[32bit]
  
        ユーザモード(`SR.S=0`)ではAR7と同一
- プログラムカウンタ(PC)[32bit]
- ステータレジスタ(SR/CCR)　 `[TTSM-III ---XNZVC]`


    - TT: トレース(00=無効,01=命令,02=分岐)
    - S:特権/ユーザフラグ(1=特権)
    - M:マスター/割り込みフラグ(1=マスター)
    - III: 割り込み優先度
    - X:拡張キャリー
    - N:符号
    - Z:ゼロ
    - V:オーバーフロー
    - C:キャリー・ボロー

- 浮動小数点数レジスタ(FP0-FP7)[96bit]
- 浮動小数点制御レジスタ(FPCR)[16bit] `[EEEEEEEE PPRR----]`

    - EEEEEEEE: 例外発生フラグ 
    - bit15: BSUN例外
    - bit14: SNAN例外
    - bit13: OPERR例外
    - bit12: OVFL例外
    - bit11: UNFL例外
    - bit10: ZD例外
    - bit9: INEX2例外
    - bit8: INEX1例外
    - PP: 丸め精度
    - 00: 拡張倍精度(80bit)
    - 01: 単精度(32bit)
    - 10: 倍精度(64bit)
    - 11: 未使用
    - RR: 丸め方法
    - 00: 最近接丸め
    - 01: 0へと丸め
    - 10: 負の無限大へと丸め
    - 11: 正の無限大へと丸め  

- 浮動小数点ステータスレジスタ(FPSR) `----NZIn qqqqqqqq eeeeeeee EEEEE000`

    - N: 符号フラグ
    - Z: ゼロフラグ
    - I: 無限大フラグ
    - n: NaNフラグ
    - q: 剰余関数除算値
    - eeeeeeee: FPU例外フラグ
    - bit15: BSUN例外
    - bit14: SNAN例外
    - bit13: OPERR例外
    - bit12: OVFL例外
    - bit11: UNFL例外
    - bit10: DZ例外
    - bit9: INEX2例外
    - bit8: INEX1例外

    - eeeeeeee: FPU例外累計フラグ
    - bit7: IOP ( SNAN or OPERR)
    - bit6: OVFL( OVFL)
    - bit7: UNFL( UNFL or INEX2 )
    - bit7: DZ ( DZ)
    - bit7: INEX ( INEX1 or INEX2 or OVFL)

- 浮動小数点命令アドレスレジスタ(FPIAR)[32bit]

    整数ユニットは、FPUが浮動小数点命令を同時に実行しているときに命令を実行できます。 さらに、FPUは2つの浮動小数点命令を同時に実行できます。 この非シーケンシャルな命令実行のため、浮動小数点例外トラップに応答してFPUによってスタックされたPC値は、問題のある命令を指していない可能性があります。

    例外トラップを生成するFPU命令のサブセットの場合、32ビットFPIARには、プロセッサが命令を実行する前に、命令の論理アドレスがロードされます。 浮動小数点例外ハンドラーは、このアドレスを使用して、例外の原因となった浮動小数点命令を見つけることができます。 FPCR、FPSR、またはFPIARおよびFMOVEM命令との間のFPU FMOVEは浮動小数点例外を生成できないため、これらの命令はFPIARを変更しません。 リセットまたはnull復元操作により、FPIARがクリアされます。
  
- ベクタベースレジスタ(VBR)[32bit]

    VBRには、メモリ内の例外ベクトルテーブルのベースアドレスが含まれています。例外ベクトルの変位は、ベクトルテーブルにアクセスするこのレジスタの値に追加されます。

- 代替ファンクションコードレジスタ(SFC/DFC)[3bit]

    代替ファンクションコードレジスタは、3ビットの機能コードを含んでいます。ファンクション・コードは、32ビット論理アドレスの拡張と考えることができ、オプションで最大8つの4Gバイト・アドレス空間を提供します。プロセッサは、ユーザーモードとスーパーバイザーモードで、データやプログラムのアドレス空間を選択するためにファンクションコードを自動的に生成します。一部の命令では、SFCとDFCを使用して、操作用のファンクション・コードを指定します。

- 透過変換制御レジスタ(DTTR0/DTTR1/ITTR0/ITTR1) `[bbbbbbbb mmmmmmmm ESS---UU -CC--W--]`

  - bbbbbbbb: ベースアドレス
    
      この8ビットフィールドは、アドレスビットA31～A24と比較されます。この比較で一致したアドレスは この比較で一致した（そして、それ以外の点で適格である）アドレスは、透過的に変換/アクセス制御されます。

  - mmmmmmmm: アドレスマスク
    
      この8ビットフィールドには、アドレスベースフィールドのマスクが含まれています。 このフィールドにビットを設定すると、アドレスベースフィールドの対応するビットが無視されます。 16Mバイトを超えるメモリのブロックは、いくつかの論理アドレスマスクビットを1に設定することにより、透過的に変換/アクセス制御できます。
      このフィールドの下位ビットは通常、16メガバイトを超える連続ブロックを定義するように設定されますが、これは必須ではありません。
         
  - E:有効フラグ

      このビットは、このレジスタによって定義されたブロックの透過的な変換/アクセス制御を有効または無効にします。

  - SS:特権モード

      このフィールドは、アドレスの照合におけるFC2の使用を指定します。
      - 00: ユーザ
      - 01: 特権
      - 1X: 任意
    
  - UU:ユーザページ属性

      68040は、これらのユーザー定義ビットを解釈しません。アクセスによって外部バス転送が発生した場合、U0とU1はそれぞれUPA0信号とUPA1信号にエコーされます。

  - C: キャッシュモード

      このフィールドは、次のようにページのキャッシュモードとアクセスシリアル化を選択します。
      - 00: キャッシュ可能、ライトスルー
      - 01: キャッシュ可能、書き戻し
      - 10: キャッシュ不可、直列化
      - 11: キャッシュ不可

  - W: 書き込み保護

      このビットは、ブロックが書き込み保護されているかどうかを示します。設定されている場合、書き込みおよび読み取り-変更-書き込みアクセスは、テーブル記述子の常駐ビットがクリアされているかのように中止されます。
- マスタースタックポインタ(MSP)
- 割り込み処理スタックポインタ(ISP)

        `SR.S=1, SR.M=1`の場合には、`AR7`の値は`MSP`と同じになる。`SR.S=1, SR.M=0`の場合には、`ISP`と同じになる

- CACR

-> キャッシュ

- MMUSR
- URP 
- SRP
  
    `vvvvvvvv vvvvvvvv vvvvvvv0 00000000`
    -v: ポインタ

- TC

## データフォーマット

### 整数レジスタ

|   サイズ | 範囲                                              |
| -------: | :------------------------------------------------ |
|      BCD | `-------- -------- -------- xxxxyyyy`             |
|        B | `-------- -------- -------- xxxxxxxx`             |
|        W | `-------- -------- xxxxxxxx xxxxxxxx`             |
|        L | `xxxxxxxx xxxxxxxx xxxxxxxx xxxxxxxx`             |
|      Bit | `31 <- -> 0`                                      |
| Bitfield | `<---- offset ---->` `<- size --------`<br>`--->` |

### アドレスレジスタ
| サイズ |                 範囲                  |
| -----: | :-----------------------------------: |
|      W | `ssssssss ssssssss sxxxxxxx xxxxxxxx` |
|      L | `xxxxxxxx xxxxxxxx xxxxxxxx xxxxxxxx` |

### メモリ
```
          addr-1   addr     addr+1   addr+2   addr+3   addr+4
          -------- xxxxxxxx xxxxxxxx xxxxxxxx xxxxxxxx --------
bit       -------- 76543210 -------- -------- -------- -------- 
bitfield  -------- <-offset -><- size  ->---- -------- --------
B         -------- xxxxxxxx -------- -------- -------- --------
W         -------- xxxxxxxx xxxxxxxx -------- -------- --------
L         -------- xxxxxxxx xxxxxxxx xxxxxxxx xxxxxxxx --------
```

## MMU






